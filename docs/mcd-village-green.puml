@startuml MCD_Village_Green

'=====================
' ENTITÉS PRINCIPALES
'=====================

!define table(x) class x << (T,#FFAAAA) >>

' Entité Categorie (incluant les sous-catégories en elle-même)
table(Categorie) {
    +id : INT
    +nom : VARCHAR(100)
    +parent_id : INT
    +niveau : INT
}

' Entité Produit
table(Produit) {
    +id : INT
    +libelle_court : VARCHAR(100)
    +libelle_long : TEXT
    +reference_fournisseur : VARCHAR(50)
    +prix_achat_ht : DECIMAL(10,2)
    +stock : INT
    +photo : VARCHAR(255)
    +actif : BOOLEAN
    +categorie_id : INT
    +fournisseur_id : INT
}

' Entité Fournisseur
table(Fournisseur) {
    +id : INT
    +nom : VARCHAR(100)
    +contact : VARCHAR(100)
    +email : VARCHAR(100)
    +telephone : VARCHAR(20)
}

' Entité Utilisateur
table(Utilisateur) {
    +id : INT
    +nom : VARCHAR(100)
    +email : VARCHAR(100)
    +role : ENUM('Responsable Produits', 'Responsable Fournisseurs', 'Commercial Particuliers', 'Commercial Professionnels')
    +type_client : ENUM('particulier', 'professionnel')
    +reference_client : VARCHAR(50)
    +coefficient : DECIMAL(3,2)
}

' Entité Adresse
table(Adresse) {
    +id : INT
    +utilisateur_id : INT
    +type_adresse : ENUM('facturation', 'livraison')
    +rue : VARCHAR(255)
    +code_postal : VARCHAR(10)
    +ville : VARCHAR(100)
    +pays : VARCHAR(100)
}

' Entité Commande
table(Commande) {
    +id : INT
    +utilisateur_id : INT
    +date_commande : DATE
    +reduction : DECIMAL(5,2)
    +mode_paiement : ENUM('carte', 'virement', 'chèque')
    +statut_paiement : ENUM('payé', 'en attente')
    +adresse_facturation_id : INT
    +adresse_livraison_id : INT
}

' Entité LigneCommande
table(LigneCommande) {
    +id : INT
    +commande_id : INT
    +produit_id : INT
    +quantite : INT
    +prix_unitaire_ht : DECIMAL(10,2)
}

' Entité Document
table(Document) {
    +id : INT
    +commande_id : INT
    +type_document : ENUM('facture', 'bon_livraison')
    +date_creation : DATE
    +chemin_fichier : VARCHAR(255)
    +statut : ENUM('en_attente', 'validé', 'archivé')
}

'===========================
' Relations entre les entités
'===========================

' Relation entre Categorie et Categorie (pour sous-catégories)
Categorie "1" -- "0..*" Categorie : parent_id
' Une catégorie peut avoir plusieurs sous-catégories (relation "1-N").
' Chaque sous-catégorie a une catégorie parente, mais une catégorie parente peut ne pas en avoir.

' Relation entre Categorie et Produit
Categorie "1" -- "0..*" Produit : categorie_id
' Une catégorie peut être liée à plusieurs produits (relation "1-N").
' Chaque produit appartient à une seule catégorie.

' Relation entre Produit et Fournisseur
Produit "1" -- "1" Fournisseur : fournisseur_id
' Un produit est fourni par un seul fournisseur (relation "1-1").
' Un fournisseur peut fournir plusieurs produits.

' Relation entre Utilisateur et Adresse
Utilisateur "1" -- "0..*" Adresse : utilisateur_id
' Un utilisateur peut avoir plusieurs adresses (relation "1-0..N").
' Chaque adresse est liée à un utilisateur, mais un utilisateur peut ne pas avoir d'adresse.

' Relation entre Utilisateur et Commande
Utilisateur "1" -- "0..*" Commande : utilisateur_id
' Un utilisateur peut passer plusieurs commandes (relation "1-0..N").
' Chaque commande est passée par un utilisateur spécifique.

' Relation entre Commande et LigneCommande
Commande "1" -- "0..*" LigneCommande : commande_id
' Une commande peut contenir plusieurs lignes de commande (relation "1-N").
' Chaque ligne de commande est associée à une commande spécifique.

' Relation entre LigneCommande et Produit
LigneCommande "1" -- "1" Produit : produit_id
' Une ligne de commande est liée à un seul produit (relation "1-1").
' Un produit peut apparaître dans plusieurs lignes de commande.

' Relation entre Commande et Adresse de facturation
Commande "1" -- "1" Adresse : adresse_facturation_id
' Chaque commande doit avoir une adresse de facturation unique (relation "1-1").

' Relation entre Commande et Adresse de livraison
Commande "1" -- "1" Adresse : adresse_livraison_id
' Chaque commande doit avoir une adresse de livraison unique (relation "1-1").

' Relation entre Commande et Document
Commande "1" -- "0..*" Document : commande_id
' Une commande peut avoir plusieurs documents associés (factures, bons de livraison) (relation "1-N").
' Chaque document est lié à une commande spécifique.

@enduml
